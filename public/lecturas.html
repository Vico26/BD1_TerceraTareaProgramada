<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Lecturas de Medidores</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #2d2fa3;
        padding: 20px;
    }
    h1 {
        text-align: center;
        margin-bottom: 30px;
        color: #ffffff;
    }
    .panel {
        background: white;
        padding: 20px;
        margin-bottom: 25px;
        border-radius: 10px;
        box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .panel h2 {
        margin-top: 0;
    }
    label {
        font-weight: bold;
    }
    input[type="text"] {
        padding: 8px;
        width: 250px;
        border-radius: 5px;
        border: 1px solid #aaa;
    }
    button {
        padding: 10px 15px;
        margin-top: 10px;
        border: none;
        border-radius: 6px;
        background-color: #007bff;
        color: white;
        font-size: 15px;
        cursor: pointer;
    }
    button:hover {
        background-color: #0056b3;
    }
    .msg {
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        font-weight: bold;
    }
    .success { background-color: #d4ffd4; color: #006600; }
    .error { background-color: #ffd4d4; color: #990000; }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }
    th, td {
        padding: 10px;
        border: 1px solid #ccc;
    }
    th {
        background: #e6e6e6;
    }
</style>
</head>
<body>

<h1>Lecturas de Medidores</h1>

<!-- ====================================== -->
<!-- LECTURAS POR MEDIDOR -->
<!-- ====================================== -->
<div class="panel">
    <h2>Lecturas por Medidor</h2>
    <label>Número de Medidor:</label>
    <input type="text" id="numeroMedidor" placeholder="Ingrese el número de medidor">
    <br>
    <button onclick="lecturasPorMedidor()">Consultar</button>

    <div id="msgMedidor"></div>
    <div id="tablaMedidor"></div>
</div>

<!-- ====================================== -->
<!-- OBTENER TODAS LAS LECTURAS -->
<!-- ====================================== -->
<div class="panel">
    <h2>Obtener todas las lecturas</h2>
    <button onclick="todasLasLecturas()">Obtener lecturas</button>

    <div id="msgTodas"></div>
    <div id="tablaTodas"></div>
</div>

<script>
function generarTabla(recordset) {
    if (!recordset || recordset.length === 0) {
        return "<p>No hay datos disponibles.</p>";
    }

    let html = "<table><tr>";

    // Encabezados
    for (let col in recordset[0]) {
        html += `<th>${col}</th>`;
    }
    html += "</tr>";

    // Filas
    recordset.forEach(row => {
        html += "<tr>";
        for (let col in row) {
            html += `<td>${row[col]}</td>`;
        }
        html += "</tr>";
    });

    html += "</table>";
    return html;
}

async function lecturasPorMedidor() {
    const numero = document.getElementById("numeroMedidor").value.trim();
    const msg = document.getElementById("msgMedidor");
    const tabla = document.getElementById("tablaMedidor");

    msg.innerHTML = "";
    tabla.innerHTML = "";

    if (!numero) {
        msg.innerHTML = "Debes ingresar un número de medidor.";
        msg.className = "msg error";
        return;
    }

    try {
        const response = await fetch(`/lecturas/${numero}`);
        const data = await response.json();

        if (response.ok && data.success) {
            msg.innerHTML = "Lecturas obtenidas correctamente.";
            msg.className = "msg success";
            tabla.innerHTML = generarTabla(data.recordset);
        } else {
            msg.innerHTML = "Error: " + (data.error || data.CodigoError);
            msg.className = "msg error";
        }
    } catch (err) {
        msg.innerHTML = "Error al comunicarse con el servidor.";
        msg.className = "msg error";
    }
}

async function todasLasLecturas() {
    const msg = document.getElementById("msgTodas");
    const tabla = document.getElementById("tablaTodas");

    msg.innerHTML = "";
    tabla.innerHTML = "";

    try {
        const response = await fetch(`/lecturas`);
        const data = await response.json();

        if (response.ok && data.success) {
            msg.innerHTML = "Todas las lecturas fueron obtenidas.";
            msg.className = "msg success";
            tabla.innerHTML = generarTabla(data.recordset);
        } else {
            msg.innerHTML = "Error: " + (data.error || data.CodigoError);
            msg.className = "msg error";
        }
    } catch (err) {
        msg.innerHTML = "Error al comunicarse con el servidor.";
        msg.className = "msg error";
    }
}
</script>

</body>
</html>
